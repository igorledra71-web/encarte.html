<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Encarte Autom√°tico Ofert√£o</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    background:#000;
    font-family:Arial,Helvetica,sans-serif;
}

#painel{
    padding:10px;
    background:#111;
}
textarea,input,select,button{
    width:100%;
    margin-top:6px;
    padding:8px;
    font-size:15px;
}
button{
    background:#d30000;
    color:#fff;
    border:none;
    font-weight:bold;
    cursor:pointer;
}

#pages{
    display:flex;
    flex-direction:column;
    align-items:center;
    margin-top:10px;
}

.page{
    width:1080px;
    height:1350px;
    background:radial-gradient(circle at top, #1a0000, #000);
    position:relative;
    margin-bottom:40px;
    padding-top:260px;
    box-sizing:border-box;
}

.topo{
    position:absolute;
    top:0; left:0; right:0;
    height:240px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:20px 40px;
    box-sizing:border-box;
}

.topo img{
    height:160px;
}

.dataBox{
    background:#e30000;
    color:#fff;
    padding:12px 22px;
    border-radius:14px;
    font-size:26px;
    font-weight:bold;
}

.grade{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    grid-template-rows:repeat(2, 1fr);
    gap:20px;
    padding:20px;
}

.card{
    background:#fff;
    border-radius:24px;
    padding:18px;
    text-align:center;
    position:relative;
    box-shadow:0 6px 20px rgba(0,0,0,0.4);
}

.card img{
    width:100%;
    height:220px;
    object-fit:contain;
}

.nome{
    font-weight:bold;
    font-size:20px;
    margin-top:10px;
    color:#000;
}

.precoBox{
    margin-top:10px;
    background:#e30000;
    color:#fff;
    padding:10px 22px;
    border-radius:18px;
    font-size:34px;
    font-weight:bold;
    display:inline-block;
}

.un{
    font-size:18px;
    margin-left:6px;
}

.edit{
    position:absolute;
    top:12px;
    right:12px;
    background:#000;
    color:#fff;
    width:30px;
    height:30px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
}

.capaProduto{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100%;
    padding:40px;
    box-sizing:border-box;
}

.capaProduto img{
    width:60%;
    height:500px;
    object-fit:contain;
}

.capaNome{
    color:#fff;
    font-size:36px;
    font-weight:bold;
    margin-top:20px;
}

.capaPreco{
    margin-top:20px;
    background:#e30000;
    color:#fff;
    padding:18px 40px;
    border-radius:22px;
    font-size:64px;
    font-weight:bold;
}

.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.7);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:9999;
}

.modalContent{
    background:#fff;
    color:#000;
    padding:20px;
    width:320px;
    border-radius:12px;
}

.modalContent input,
.modalContent select{
    width:100%;
    margin-top:8px;
    padding:8px;
    font-size:14px;
}

.modalContent button{
    margin-top:10px;
}
</style>
</head>

<body>
<div id="painel">
    <select id="dia">
        <option value="terca.png">Ter√ßa Extra</option>
        <option value="quarta.png">Quarta Extra</option>
        <option value="quinta.png">Quinta Extra</option>
        <option value="fds.png">Final de Semana de Ofertas</option>
    </select>

    <input type="text" id="dataValidade" value="V√ÅLIDAS 15/01/26">

    <textarea id="listaProdutos" rows="8" placeholder="Cole aqui sua lista de produtos exatamente como voc√™ manda no Whats..."></textarea>

    <button onclick="gerarEncarte()">GERAR ENCARTE</button>
</div>

<div id="pages"></div>

<!-- MODAL DE EDI√á√ÉO -->
<div class="modal" id="modalEdicao">
    <div class="modalContent">
        <h3>Editar Produto</h3>

        <input type="text" id="editNome" placeholder="Nome do produto">
        <input type="text" id="editPreco" placeholder="Pre√ßo (ex: 9,99)">

        <select id="editUnidade">
            <option value="kg">kg</option>
            <option value="un">un</option>
        </select>

        <input type="file" id="editFoto">

        <button onclick="salvarEdicao()">Salvar</button>
        <button onclick="fecharModal()">Cancelar</button>
    </div>
</div>
<script>
let produtoAtual = null;

function gerarEncarte(){
    const texto = document.getElementById('listaProdutos').value.split('\n');
    const diaImg = document.getElementById('dia').value;
    const data = document.getElementById('dataValidade').value;
    const pages = document.getElementById('pages');

    pages.innerHTML = '';

    let capas = [];
    let normais = [];

    texto.forEach(linha => {
        let l = linha.trim();
        if(l === '') return;

        if(l.startsWith('üö®')){
            capas.push(l.replace('üö®','').trim());
        } else {
            normais.push(l);
        }
    });

    // cria capas
    capas.forEach(produtoTexto => {
        const page = criarPaginaCapa(produtoTexto, diaImg, data);
        pages.appendChild(page);
    });

    // cria p√°ginas normais (6 por p√°gina)
    for(let i = 0; i < normais.length; i += 6){
        const grupo = normais.slice(i, i + 6);
        const page = criarPaginaNormal(grupo, diaImg, data);
        pages.appendChild(page);
    }
}

function criarTopo(diaImg, data){
    const topo = document.createElement('div');
    topo.className = 'topo';

    const logoDia = document.createElement('img');
    logoDia.src = diaImg;

    const estrela = document.createElement('img');
    estrela.src = 'logo-estrela.png';

    const dataBox = document.createElement('div');
    dataBox.className = 'dataBox';
    dataBox.innerText = data;

    topo.appendChild(logoDia);
    topo.appendChild(estrela);
    topo.appendChild(dataBox);

    return topo;
}

function extrairPrecoFinal(texto){
    const precos = texto.match(/\d+,\d+/g);
    if(!precos) return '';
    return precos[precos.length - 1]; // SEMPRE o √∫ltimo
}

function detectarUnidade(texto){
    if(texto.toLowerCase().includes('kg')) return 'kg';
    return 'un';
}

function limparNome(texto){
    // remove pre√ßos
    let nome = texto.replace(/\d+,\d+/g,'');
    // remove h√≠fen
    nome = nome.replace('-','');
    return nome.trim();
}

function criarPaginaNormal(lista, diaImg, data){
    const page = document.createElement('div');
    page.className = 'page';

    page.appendChild(criarTopo(diaImg, data));

    const grade = document.createElement('div');
    grade.className = 'grade';

    lista.forEach(texto => {
        const card = criarCardProduto(texto);
        grade.appendChild(card);
    });

    page.appendChild(grade);
    return page;
}

function criarPaginaCapa(texto, diaImg, data){
    const page = document.createElement('div');
    page.className = 'page';

    page.appendChild(criarTopo(diaImg, data));

    const box = document.createElement('div');
    box.className = 'capaProduto';

    const img = document.createElement('img');
    img.src = buscarImagem(texto);

    const nome = document.createElement('div');
    nome.className = 'capaNome';
    nome.innerText = limparNome(texto);

    const precoValor = extrairPrecoFinal(texto);
    const unidade = detectarUnidade(texto);

    const preco = document.createElement('div');
    preco.className = 'capaPreco';
    preco.innerText = `R$${precoValor} ${unidade}`;

    const edit = document.createElement('div');
    edit.className = 'edit';
    edit.innerText = '‚úé';
    edit.onclick = () => abrirModal(nome, preco, img);

    box.appendChild(edit);
    box.appendChild(img);
    box.appendChild(nome);
    box.appendChild(preco);

    page.appendChild(box);
    return page;
}

function criarCardProduto(texto){
    const card = document.createElement('div');
    card.className = 'card';

    const img = document.createElement('img');
    img.src = buscarImagem(texto);

    const nome = document.createElement('div');
    nome.className = 'nome';
    nome.innerText = limparNome(texto);

    const precoValor = extrairPrecoFinal(texto);
    const unidade = detectarUnidade(texto);

    const preco = document.createElement('div');
    preco.className = 'precoBox';
    preco.innerHTML = `R$${precoValor} <span class="un">${unidade}</span>`;

    const edit = document.createElement('div');
    edit.className = 'edit';
    edit.innerText = '‚úé';
    edit.onclick = () => abrirModal(nome, preco, img);

    card.appendChild(edit);
    card.appendChild(img);
    card.appendChild(nome);
    card.appendChild(preco);

    return card;
}
function buscarImagem(texto){
    // usa Bing Images (funciona em site est√°tico)
    const query = encodeURIComponent(limparNome(texto));
    return "https://www.bing.com/images/search?q=" + query + "&form=HDRSC2";
}

function abrirModal(nomeEl, precoEl, imgEl){
    produtoAtual = { nomeEl, precoEl, imgEl };

    // preenche campos
    document.getElementById('editNome').value = nomeEl.innerText;

    // pre√ßo pode estar como "R$9,99 kg" ou "R$9,99 un"
    const partes = precoEl.innerText.replace('R$','').split(' ');
    document.getElementById('editPreco').value = partes[0] || '';
    document.getElementById('editUnidade').value = partes[1] || 'un';

    document.getElementById('editFoto').value = '';

    document.getElementById('modalEdicao').style.display = 'flex';
}

function fecharModal(){
    document.getElementById('modalEdicao').style.display = 'none';
}

function salvarEdicao(){
    if(!produtoAtual) return;

    const novoNome = document.getElementById('editNome').value;
    const novoPreco = document.getElementById('editPreco').value;
    const novaUnidade = document.getElementById('editUnidade').value;
    const novaFoto = document.getElementById('editFoto').files[0];

    // atualiza nome
    produtoAtual.nomeEl.innerText = novoNome;

    // atualiza pre√ßo
    produtoAtual.precoEl.innerText = `R$${novoPreco} ${novaUnidade}`;

    // atualiza foto se houver
    if(novaFoto){
        const reader = new FileReader();
        reader.onload = function(e){
            produtoAtual.imgEl.src = e.target.result;
        };
        reader.readAsDataURL(novaFoto);
    }

    fecharModal();
}

// fecha modal ao clicar fora
document.addEventListener('click', function(e){
    const modal = document.getElementById('modalEdicao');
    if(e.target === modal){
        fecharModal();
    }
});
</script>
</body>
</html>
