<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Encarte Autom√°tico - Ofert√£o</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
body{margin:0;background:#111;font-family:Arial,Helvetica,sans-serif;color:#fff}
#panel{padding:10px;background:#000}
select,textarea,input,button{width:100%;padding:8px;margin-top:6px;font-size:15px}
button{background:#b80000;color:#fff;border:none;font-weight:bold;cursor:pointer}
#pages{display:flex;flex-direction:column;align-items:center;margin-top:10px}

.page{
    width:1080px;height:1350px;
    background:#f5f5f5;color:#000;
    margin-bottom:30px;
    padding:20px;box-sizing:border-box;
    position:relative;
    display:grid;
    grid-template-columns:1fr 1fr;
    grid-auto-rows:auto;
    gap:15px;
}

.header{
    grid-column:1/3;
    background:linear-gradient(180deg,#000,#300);
    color:#fff;
    padding:15px;
    text-align:center;
}

.header img{height:70px;margin-bottom:5px}
.header .title3d{height:90px;margin-top:5px}

.sub{font-size:18px;margin-top:5px}

.card{
    background:#fff;
    border-radius:12px;
    padding:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.2);
    position:relative;
}

.card img{width:100%;height:180px;object-fit:contain}

.name{font-weight:bold;font-size:18px;margin-top:5px}
.price{font-size:32px;color:#b80000;font-weight:bold}

.editBtn{
    position:absolute;top:8px;right:8px;
    background:#000;color:#fff;border-radius:50%;
    width:28px;height:28px;
    display:flex;align-items:center;justify-content:center;
    cursor:pointer;font-size:14px;
}

.cover{
    grid-column:1/3;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    background:linear-gradient(160deg,#000,#b80000);
    color:#fff;
}

.cover img{width:60%;height:300px;object-fit:contain}

.cover .price{color:#ffeb3b;font-size:48px}

.modal{
    position:fixed;inset:0;
    background:rgba(0,0,0,0.7);
    display:none;align-items:center;justify-content:center;
    z-index:9999;
}
.modalContent{
    background:#fff;color:#000;
    padding:20px;width:300px;border-radius:10px;
}
.modalContent input,select{width:100%;margin-top:6px;padding:6px}
</style>
</head>

<body>

<div id="panel">
    <select id="dia">
        <option value="terca.png">Ter√ßa Extra</option>
        <option value="quarta.png">Quarta Extra</option>
        <option value="quinta.png">Quinta Extra</option>
        <option value="fds.png">Final de Semana de Ofertas</option>
    </select>

    <input type="text" id="data" placeholder="Ofertas v√°lidas 16/01" value="Ofertas v√°lidas 16/01">

    <textarea id="lista" rows="10" placeholder="Cole sua lista aqui..."></textarea>

    <button onclick="gerar()">GERAR ENCARTE</button>
</div>

<div id="pages"></div>

<!-- MODAL EDI√á√ÉO -->
<div class="modal" id="modal">
    <div class="modalContent">
        <h3>Editar Produto</h3>
        <input type="text" id="editNome" placeholder="Nome">
        <input type="text" id="editPreco" placeholder="Pre√ßo">
        <select id="editUn">
            <option value="kg">kg</option>
            <option value="un">un</option>
        </select>
        <input type="file" id="editFoto">
        <button onclick="salvarEdicao()">Salvar</button>
        <button onclick="fecharModal()">Cancelar</button>
    </div>
</div>

<script>
let currentCard=null;

function gerar(){
    const texto=document.getElementById('lista').value.split('\n');
    const diaImg=document.getElementById('dia').value;
    const data=document.getElementById('data').value;
    const pages=document.getElementById('pages');
    pages.innerHTML='';

    let capas=[];
    let normais=[];

    texto.forEach(l=>{
        if(l.trim()==='')return;
        if(l.startsWith('üö®')) capas.push(l.replace('üö®','').trim());
        else normais.push(l.trim());
    });

    capas.forEach(prod=>{
        pages.appendChild(criarCapa(prod,diaImg,data));
    });

    for(let i=0;i<normais.length;i+=6){
        pages.appendChild(criarPagina(normais.slice(i,i+6),diaImg,data));
    }
}

function criarHeader(diaImg,data){
    const h=document.createElement('div');
    h.className='header';

    const logo=document.createElement('img');
    logo.src='logo-estrela.png';

    const dia=document.createElement('img');
    dia.src=diaImg;
    dia.className='title3d';

    const sub=document.createElement('div');
    sub.className='sub';
    sub.innerText=data;

    h.appendChild(logo);
    h.appendChild(dia);
    h.appendChild(sub);
    return h;
}

function criarCapa(texto,diaImg,data){
    const p=document.createElement('div');
    p.className='page cover';

    p.appendChild(criarHeader(diaImg,data));

    const img=document.createElement('img');
    img.src='https://source.unsplash.com/800x600/?'+encodeURIComponent(texto);

    const nome=document.createElement('div');
    nome.className='name';
    nome.innerText=texto.replace(/(\d+,\d+)/,'');

    const preco=document.createElement('div');
    preco.className='price';
    const valor=texto.match(/(\d+,\d+)/)?.[0]||'';
    const un=texto.toLowerCase().includes('kg')?'kg':'un';
    preco.innerText=valor+' '+un;

    const edit=document.createElement('div');
    edit.className='editBtn';
    edit.innerText='‚úé';
    edit.onclick=()=>abrirModal(nome,preco,img);

    p.appendChild(img);
    p.appendChild(nome);
    p.appendChild(preco);
    p.appendChild(edit);

    return p;
}

function criarPagina(lista,diaImg,data){
    const p=document.createElement('div');
    p.className='page';
    p.appendChild(criarHeader(diaImg,data));

    lista.forEach(texto=>{
        const c=document.createElement('div');
        c.className='card';

        const img=document.createElement('img');
        img.src='https://source.unsplash.com/400x400/?'+encodeURIComponent(texto);

        const nome=document.createElement('div');
        nome.className='name';
        nome.innerText=texto.replace(/(\d+,\d+)/,'');

        const preco=document.createElement('div');
        preco.className='price';
        const valor=texto.match(/(\d+,\d+)/)?.[0]||'';
        const un=texto.toLowerCase().includes('kg')?'kg':'un';
        preco.innerText=valor+' '+un;

        const edit=document.createElement('div');
        edit.className='editBtn';
        edit.innerText='‚úé';
        edit.onclick=()=>abrirModal(nome,preco,img);

        c.appendChild(edit);
        c.appendChild(img);
        c.appendChild(nome);
        c.appendChild(preco);
        p.appendChild(c);
    });

    return p;
}

function abrirModal(nome,preco,img){
    currentCard={nome,preco,img};
    document.getElementById('editNome').value=nome.innerText;
    document.getElementById('editPreco').value=preco.innerText.split(' ')[0];
    document.getElementById('editUn').value=preco.innerText.split(' ')[1]||'un';
    document.getElementById('modal').style.display='flex';
}

function fecharModal(){
    document.getElementById('modal').style.display='none';
}

function salvarEdicao(){
    const n=document.getElementById('editNome').value;
    const p=document.getElementById('editPreco').value;
    const u=document.getElementById('editUn').value;
    const f=document.getElementById('editFoto').files[0];

    currentCard.nome.innerText=n;
    currentCard.preco.innerText=p+' '+u;

    if(f){
        const reader=new FileReader();
        reader.onload=e=>{
            currentCard.img.src=e.target.result;
        }
        reader.readAsDataURL(f);
    }

    fecharModal();
}
</script>

</body>
</html>



